================================================================================
THÃ”NG TIN Dá»° ÃN HOÃ€N CHá»ˆNH
================================================================================
Thá»i gian táº¡o: 2025-08-11 16:42:31
ThÆ° má»¥c gá»‘c: d:\Atino\extension\inventory-flow-tracker
================================================================================

ğŸ“ Cáº¤U TRÃšC THU Má»¤C
--------------------------------------------------
â”œâ”€â”€ ğŸ“ src/
â”‚   â””â”€â”€ ğŸ“ utils/
â”‚       â”œâ”€â”€ ğŸ“„ api.py
â”‚       â”œâ”€â”€ ğŸ“„ cache.py
â”‚       â”œâ”€â”€ ğŸ“„ config.py
â”‚       â”œâ”€â”€ ğŸ“„ larkbase.py
â”‚       â””â”€â”€ ğŸ“„ transport_provider.py
â”œâ”€â”€ ğŸ“ static/
â”‚   â”œâ”€â”€ ğŸ“„ app.js
â”‚   â””â”€â”€ ğŸ“„ style.css
â”œâ”€â”€ ğŸ“ templates/
â”‚   â”œâ”€â”€ ğŸ“„ _create_form.html
â”‚   â”œâ”€â”€ ğŸ“„ _employee_dropdown.html
â”‚   â”œâ”€â”€ ğŸ“„ _transport_dropdown.html
â”‚   â”œâ”€â”€ ğŸ“„ _update_form.html
â”‚   â”œâ”€â”€ ğŸ“„ _view_only.html
â”‚   â””â”€â”€ ğŸ“„ index.html
â”œâ”€â”€ ğŸ“„ .gitignore
â”œâ”€â”€ ğŸ“„ docker-compose.yml
â”œâ”€â”€ ğŸ“„ Dockerfile
â”œâ”€â”€ ğŸ“„ Get detail code.ipynb
â”œâ”€â”€ ğŸ“„ main.py
â”œâ”€â”€ ğŸ“„ project_complete_info.txt
â”œâ”€â”€ ğŸ“„ README.md
â”œâ”€â”€ ğŸ“„ requirements.txt
â”œâ”€â”€ ğŸ“„ services.py
â””â”€â”€ ğŸ“„ transport_providers.json


ğŸ“„ DANH SÃCH Táº¤T Cáº¢ FILE
--------------------------------------------------
.gitignore (327 bytes)
docker-compose.yml (349 bytes)
Dockerfile (523 bytes)
Get detail code.ipynb (9290 bytes)
main.py (8957 bytes)
project_complete_info.txt (0 bytes)
README.md (260 bytes)
requirements.txt (64 bytes)
services.py (7612 bytes)
src\utils\api.py (2109 bytes)
src\utils\cache.py (3906 bytes)
src\utils\config.py (1849 bytes)
src\utils\larkbase.py (5641 bytes)
src\utils\transport_provider.py (3208 bytes)
static\app.js (11823 bytes)
static\style.css (10159 bytes)
templates\_create_form.html (13085 bytes)
templates\_employee_dropdown.html (2596 bytes)
templates\_transport_dropdown.html (1201 bytes)
templates\_update_form.html (14270 bytes)
templates\_view_only.html (3359 bytes)
templates\index.html (2169 bytes)
transport_providers.json (535 bytes)

Tá»•ng cá»™ng: 23 file

ğŸ’» Ná»˜I DUNG Táº¤T Cáº¢ FILE CODE
================================================================================

============================================================
FILE: docker-compose.yml
============================================================
version: '3.8'
services:
  imex-app-fastapi:
    build: .
    ports:` 
      - "8000:8000"
    volumes:
      - ./src:/app/src
      - ./templates:/app/templates
      - ./main.py:/app/main.py
    # Äá»ƒ tá»± Ä‘á»™ng reload khi code thay Ä‘á»•i trong lÃºc phÃ¡t triá»ƒn
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

============================================================

============================================================
FILE: main.py
============================================================
from fastapi import FastAPI, Request, Form, Response
from fastapi.responses import HTMLResponse, JSONResponse
from fastapi.templating import Jinja2Templates
from fastapi.staticfiles import StaticFiles
from services import RecordService, EmployeeService, TransportProviderService

app = FastAPI(title="IMEX Distribution API")

# Static files
app.mount("/static", StaticFiles(directory="static"), name="static")
templates = Jinja2Templates(directory="templates")

# Services
APP_TOKEN = "Rm9PbvKLeaFFZcsSQpElnRjIgXg"
TABLE_ID = "tblJJPUEFhsXHaxY"
record_service = RecordService(APP_TOKEN, TABLE_ID)
employee_service = EmployeeService()
transport_provider_service = TransportProviderService(APP_TOKEN)

def format_timestamp_ms_to_dt_string(ts_ms):
    if not ts_ms: return ""
    try:
        import datetime
        return datetime.datetime.fromtimestamp(int(ts_ms) / 1000).strftime('%Y-%m-%d %H:%M:%S')
    except (ValueError, TypeError):
        return str(ts_ms)

@app.get("/", response_class=HTMLResponse)
async def read_root(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})

# @app.post("/search", response_class=HTMLResponse)
# async def search_bill(request: Request, bill_id: str = Form(...)):
#     if not bill_id:
#         return HTMLResponse("<div class='error'>Vui lÃ²ng nháº­p Bill ID.</div>")

#     found, record = record_service.search_record(bill_id)
#     context = {
#         "request": request,
#         "employees": employee_service.get_employees(),
#         "transport_providers": transport_provider_service.get_transport_providers()  # â† THÃŠM Má»šI
#     }

#     if found and record:
#         from src.utils.config import LOCK_FIELDS
#         has_lock_values = any(record.get("fields", {}).get(f) for f in LOCK_FIELDS)
#         context.update({
#             "record": record,
#             "can_delete": not has_lock_values,
#             "lock_fields": ', '.join(LOCK_FIELDS),
#             "format_ts": format_timestamp_ms_to_dt_string
#         })
#         return templates.TemplateResponse("_update_form.html", context)
#     else:
#         imex_items = record_service.get_api_data(bill_id)
#         if not imex_items:
#             return HTMLResponse("<div class='error'>âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u, kiá»ƒm tra láº¡i Bill ID.</div>")

#         example_item = imex_items[0]
#         context["api_data"] = {
#             "ID": bill_id,
#             "ID kho Ä‘i": example_item.get("fromDepotId", ""),
#             "Kho Ä‘i": example_item.get("fromDepotName", ""),
#             "ID kho Ä‘áº¿n": example_item.get("toDepotId", ""),
#             "Kho Ä‘áº¿n": example_item.get("toDepotName", ""),
#             "Sá»‘ lÆ°á»£ng": int(example_item.get("realQuantity") or 0),
#         }
#         from src.utils.config import CREATABLE_FIELDS
#         context["creatable_fields"] = CREATABLE_FIELDS
#         return templates.TemplateResponse("_create_form.html", context)

@app.post("/search", response_class=HTMLResponse)
async def search_bill(request: Request, bill_id: str = Form(...)):
    if not bill_id:
        return HTMLResponse("<div class='error'>Vui lÃ²ng nháº­p Bill ID.</div>")

    found, record = record_service.search_record(bill_id)
    context = {
        "request": request,
        "employees": employee_service.get_employees(),
        "transport_providers": transport_provider_service.get_transport_providers()
    }

    if found and record:
        # â† Sá»¬A: Chá»‰ hiá»ƒn thá»‹ thÃ´ng tin, khÃ´ng cho edit
        context.update({
            "record": record,
            "format_ts": format_timestamp_ms_to_dt_string
        })
        # â† Sá»¬A: Táº¡o template má»›i hoáº·c sá»­a template Ä‘á»ƒ chá»‰ hiá»ƒn thá»‹
        return templates.TemplateResponse("_view_only.html", context)
    else:
        # Pháº§n táº¡o má»›i váº«n giá»¯ nguyÃªn
        imex_items = record_service.get_api_data(bill_id)
        if not imex_items:
            return HTMLResponse("<div class='error'>âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u, kiá»ƒm tra láº¡i Bill ID.</div>")

        example_item = imex_items[0]
        context["api_data"] = {
            "ID": bill_id,
            "ID kho Ä‘i": example_item.get("fromDepotId", ""),
            "Kho Ä‘i": example_item.get("fromDepotName", ""),
            "ID kho Ä‘áº¿n": example_item.get("toDepotId", ""),
            "Kho Ä‘áº¿n": example_item.get("toDepotName", ""),
            "Sá»‘ lÆ°á»£ng": int(example_item.get("realQuantity") or 0),
        }
        from src.utils.config import CREATABLE_FIELDS
        context["creatable_fields"] = CREATABLE_FIELDS
        return templates.TemplateResponse("_create_form.html", context)


@app.post("/records", response_class=HTMLResponse)
async def create_record(request: Request):
    form_data = await request.form()
    bill_id = form_data.get("ID", "KhÃ´ng rÃµ")
    success, message = record_service.create_record(form_data)

    if success:
        return HTMLResponse(f"<div class='success'>âœ… ÄÃ£ thÃªm thÃ nh cÃ´ng Bill ID: {bill_id}</div>")
    else:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i khi thÃªm má»›i: {message}</div>")

@app.put("/records/{record_id}", response_class=HTMLResponse)
async def update_record(record_id: str, request: Request):
    form_data = await request.form()
    success, message = record_service.update_record(record_id, form_data)
    
    if success:
        return HTMLResponse("<div class='success'>ğŸ“ Cáº­p nháº­t thÃ nh cÃ´ng. Form Ä‘Ã£ Ä‘Æ°á»£c reset.</div>")
    else:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i khi cáº­p nháº­t: {message}</div>")

@app.delete("/records/{record_id}", response_class=Response)
async def delete_record_endpoint(record_id: str):
    success, message = record_service.delete_record(record_id)
    if success:
        return Response(status_code=200, content="<div class='success'>ğŸ—‘ï¸ ÄÃ£ xÃ³a thÃ nh cÃ´ng.</div>")
    else:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i khi xÃ³a: {message}</div>", status_code=400)

def get_employee_display(employee_id, employees):
    """TÃ¬m vÃ  tráº£ vá» chuá»—i 'TÃªn (ID)' tá»« danh sÃ¡ch nhÃ¢n viÃªn."""
    if not employee_id or not employees:
        return ""
    for emp in employees:
        if emp.get('id') == employee_id:
            return f"{emp.get('name', '')} ({emp.get('id', '')})"
    return employee_id # Tráº£ vá» ID náº¿u khÃ´ng tÃ¬m tháº¥y

# â† THÃŠM Má»šI: Filter cho hiá»ƒn thá»‹ tÃªn nhÃ  cung cáº¥p
def get_transport_provider_display(provider_id, transport_providers):
    """TÃ¬m vÃ  tráº£ vá» tÃªn nhÃ  cung cáº¥p tá»« ID."""
    if not provider_id or not transport_providers:
        return provider_id
    for provider in transport_providers:
        if provider.get('id') == provider_id:
            return provider.get('name', provider_id)
    return provider_id # Tráº£ vá» ID náº¿u khÃ´ng tÃ¬m tháº¥y

templates.env.filters['get_employee_display'] = get_employee_display
templates.env.filters['get_transport_provider_display'] = get_transport_provider_display  # â† THÃŠM Má»šI

@app.post("/refresh-employees", response_class=HTMLResponse)
async def refresh_employees_endpoint():
    """Endpoint Ä‘á»ƒ lÃ m má»›i danh sÃ¡ch nhÃ¢n viÃªn"""
    try:
        import time
        time.sleep(0.5)  # Táº¡o cáº£m giÃ¡c xá»­ lÃ½
        
        success, message = employee_service.refresh_employees()
        
        if success:
            return HTMLResponse(f"<div class='success'>âœ… {message}</div>")
        else:
            return HTMLResponse(f"<div class='error'>âŒ Lá»—i: {message}</div>")
            
    except Exception as e:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i há»‡ thá»‘ng: {str(e)}</div>")

# â† THÃŠM Má»šI: Endpoint Ä‘á»ƒ refresh transport providers
@app.post("/refresh-transport-providers", response_class=HTMLResponse)
async def refresh_transport_providers_endpoint():
    """Endpoint Ä‘á»ƒ lÃ m má»›i danh sÃ¡ch Ä‘Æ¡n vá»‹ váº­n chuyá»ƒn"""
    try:
        import time
        time.sleep(0.5)  # Táº¡o cáº£m giÃ¡c xá»­ lÃ½
        
        # Báº¡n cáº§n thay "tblDefault" báº±ng table ID thá»±c táº¿ chá»©a nhÃ  cung cáº¥p
        # VÃ­ dá»¥: "tblXXXXXXXXXXXXXXX"
        success, message = transport_provider_service.refresh_transport_providers("tblyiELQIi6M1j1r")
        
        if success:
            return HTMLResponse(f"<div class='success'>âœ… {message}</div>")
        else:
            return HTMLResponse(f"<div class='error'>âŒ Lá»—i: {message}</div>")
            
    except Exception as e:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i há»‡ thá»‘ng: {str(e)}</div>")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)

============================================================

============================================================
FILE: project_complete_info.txt
============================================================
================================================================================
THÃ”NG TIN Dá»° ÃN HOÃ€N CHá»ˆNH
================================================================================
Thá»i gian táº¡o: 2025-08-11 16:42:31
ThÆ° má»¥c gá»‘c: d:\Atino\extension\inventory-flow-tracker
================================================================================

ğŸ“ Cáº¤U TRÃšC THU Má»¤C
--------------------------------------------------
â”œâ”€â”€ ğŸ“ src/
â”‚   â””â”€â”€ ğŸ“ utils/
â”‚       â”œâ”€â”€ ğŸ“„ api.py
â”‚       â”œâ”€â”€ ğŸ“„ cache.py
â”‚       â”œâ”€â”€ ğŸ“„ config.py
â”‚       â”œâ”€â”€ ğŸ“„ larkbase.py
â”‚       â””â”€â”€ ğŸ“„ transport_provider.py
â”œâ”€â”€ ğŸ“ static/
â”‚   â”œâ”€â”€ ğŸ“„ app.js
â”‚   â””â”€â”€ ğŸ“„ style.css
â”œâ”€â”€ ğŸ“ templates/
â”‚   â”œâ”€â”€ ğŸ“„ _create_form.html
â”‚   â”œâ”€â”€ ğŸ“„ _employee_dropdown.html
â”‚   â”œâ”€â”€ ğŸ“„ _transport_dropdown.html
â”‚   â”œâ”€â”€ ğŸ“„ _update_form.html
â”‚   â”œâ”€â”€ ğŸ“„ _view_only.html
â”‚   â””â”€â”€ ğŸ“„ index.html
â”œâ”€â”€ ğŸ“„ .gitignore
â”œâ”€â”€ ğŸ“„ docker-compose.yml
â”œâ”€â”€ ğŸ“„ Dockerfile
â”œâ”€â”€ ğŸ“„ Get detail code.ipynb
â”œâ”€â”€ ğŸ“„ main.py
â”œâ”€â”€ ğŸ“„ project_complete_info.txt
â”œâ”€â”€ ğŸ“„ README.md
â”œâ”€â”€ ğŸ“„ requirements.txt
â”œâ”€â”€ ğŸ“„ services.py
â””â”€â”€ ğŸ“„ transport_providers.json


ğŸ“„ DANH SÃCH Táº¤T Cáº¢ FILE
--------------------------------------------------
.gitignore (327 bytes)
docker-compose.yml (349 bytes)
Dockerfile (523 bytes)
Get detail code.ipynb (9290 bytes)
main.py (8957 bytes)
project_complete_info.txt (0 bytes)
README.md (260 bytes)
requirements.txt (64 bytes)
services.py (7612 bytes)
src\utils\api.py (2109 bytes)
src\utils\cache.py (3906 bytes)
src\utils\config.py (1849 bytes)
src\utils\larkbase.py (5641 bytes)
src\utils\transport_provider.py (3208 bytes)
static\app.js (11823 bytes)
static\style.css (10159 bytes)
templates\_create_form.html (13085 bytes)
templates\_employee_dropdown.html (2596 bytes)
templates\_transport_dropdown.html (1201 bytes)
templates\_update_form.html (14270 bytes)
templates\_view_only.html (3359 bytes)
templates\index.html (2169 bytes)
transport_providers.json (535 bytes)

Tá»•ng cá»™ng: 23 file

ğŸ’» Ná»˜I DUNG Táº¤T Cáº¢ FILE CODE
================================================================================

============================================================
FILE: docker-compose.yml
============================================================
version: '3.8'
services:
  imex-app-fastapi:
    build: .
    ports:` 
      - "8000:8000"
    volumes:
      - ./src:/app/src
      - ./templates:/app/templates
      - ./main.py:/app/main.py
    # Äá»ƒ tá»± Ä‘á»™ng reload khi code thay Ä‘á»•i trong lÃºc phÃ¡t triá»ƒn
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

============================================================

============================================================
FILE: main.py
============================================================
from fastapi import FastAPI, Request, Form, Response
from fastapi.responses import HTMLResponse, JSONResponse
from fastapi.templating import Jinja2Templates
from fastapi.staticfiles import StaticFiles
from services import RecordService, EmployeeService, TransportProviderService

app = FastAPI(title="IMEX Distribution API")

# Static files
app.mount("/static", StaticFiles(directory="static"), name="static")
templates = Jinja2Templates(directory="templates")

# Services
APP_TOKEN = "Rm9PbvKLeaFFZcsSQpElnRjIgXg"
TABLE_ID = "tblJJPUEFhsXHaxY"
record_service = RecordService(APP_TOKEN, TABLE_ID)
employee_service = EmployeeService()
transport_provider_service = TransportProviderService(APP_TOKEN)

def format_timestamp_ms_to_dt_string(ts_ms):
    if not ts_ms: return ""
    try:
        import datetime
        return datetime.datetime.fromtimestamp(int(ts_ms) / 1000).strftime('%Y-%m-%d %H:%M:%S')
    except (ValueError, TypeError):
        return str(ts_ms)

@app.get("/", response_class=HTMLResponse)
async def read_root(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})

# @app.post("/search", response_class=HTMLResponse)
# async def search_bill(request: Request, bill_id: str = Form(...)):
#     if not bill_id:
#         return HTMLResponse("<div class='error'>Vui lÃ²ng nháº­p Bill ID.</div>")

#     found, record = record_service.search_record(bill_id)
#     context = {
#         "request": request,
#         "employees": employee_service.get_employees(),
#         "transport_providers": transport_provider_service.get_transport_providers()  # â† THÃŠM Má»šI
#     }

#     if found and record:
#         from src.utils.config import LOCK_FIELDS
#         has_lock_values = any(record.get("fields", {}).get(f) for f in LOCK_FIELDS)
#         context.update({
#             "record": record,
#             "can_delete": not has_lock_values,
#             "lock_fields": ', '.join(LOCK_FIELDS),
#             "format_ts": format_timestamp_ms_to_dt_string
#         })
#         return templates.TemplateResponse("_update_form.html", context)
#     else:
#         imex_items = record_service.get_api_data(bill_id)
#         if not imex_items:
#             return HTMLResponse("<div class='error'>âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u, kiá»ƒm tra láº¡i Bill ID.</div>")

#         example_item = imex_items[0]
#         context["api_data"] = {
#             "ID": bill_id,
#             "ID kho Ä‘i": example_item.get("fromDepotId", ""),
#             "Kho Ä‘i": example_item.get("fromDepotName", ""),
#             "ID kho Ä‘áº¿n": example_item.get("toDepotId", ""),
#             "Kho Ä‘áº¿n": example_item.get("toDepotName", ""),
#             "Sá»‘ lÆ°á»£ng": int(example_item.get("realQuantity") or 0),
#         }
#         from src.utils.config import CREATABLE_FIELDS
#         context["creatable_fields"] = CREATABLE_FIELDS
#         return templates.TemplateResponse("_create_form.html", context)

@app.post("/search", response_class=HTMLResponse)
async def search_bill(request: Request, bill_id: str = Form(...)):
    if not bill_id:
        return HTMLResponse("<div class='error'>Vui lÃ²ng nháº­p Bill ID.</div>")

    found, record = record_service.search_record(bill_id)
    context = {
        "request": request,
        "employees": employee_service.get_employees(),
        "transport_providers": transport_provider_service.get_transport_providers()
    }

    if found and record:
        # â† Sá»¬A: Chá»‰ hiá»ƒn thá»‹ thÃ´ng tin, khÃ´ng cho edit
        context.update({
            "record": record,
            "format_ts": format_timestamp_ms_to_dt_string
        })
        # â† Sá»¬A: Táº¡o template má»›i hoáº·c sá»­a template Ä‘á»ƒ chá»‰ hiá»ƒn thá»‹
        return templates.TemplateResponse("_view_only.html", context)
    else:
        # Pháº§n táº¡o má»›i váº«n giá»¯ nguyÃªn
        imex_items = record_service.get_api_data(bill_id)
        if not imex_items:
            return HTMLResponse("<div class='error'>âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u, kiá»ƒm tra láº¡i Bill ID.</div>")

        example_item = imex_items[0]
        context["api_data"] = {
            "ID": bill_id,
            "ID kho Ä‘i": example_item.get("fromDepotId", ""),
            "Kho Ä‘i": example_item.get("fromDepotName", ""),
            "ID kho Ä‘áº¿n": example_item.get("toDepotId", ""),
            "Kho Ä‘áº¿n": example_item.get("toDepotName", ""),
            "Sá»‘ lÆ°á»£ng": int(example_item.get("realQuantity") or 0),
        }
        from src.utils.config import CREATABLE_FIELDS
        context["creatable_fields"] = CREATABLE_FIELDS
        return templates.TemplateResponse("_create_form.html", context)


@app.post("/records", response_class=HTMLResponse)
async def create_record(request: Request):
    form_data = await request.form()
    bill_id = form_data.get("ID", "KhÃ´ng rÃµ")
    success, message = record_service.create_record(form_data)

    if success:
        return HTMLResponse(f"<div class='success'>âœ… ÄÃ£ thÃªm thÃ nh cÃ´ng Bill ID: {bill_id}</div>")
    else:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i khi thÃªm má»›i: {message}</div>")

@app.put("/records/{record_id}", response_class=HTMLResponse)
async def update_record(record_id: str, request: Request):
    form_data = await request.form()
    success, message = record_service.update_record(record_id, form_data)
    
    if success:
        return HTMLResponse("<div class='success'>ğŸ“ Cáº­p nháº­t thÃ nh cÃ´ng. Form Ä‘Ã£ Ä‘Æ°á»£c reset.</div>")
    else:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i khi cáº­p nháº­t: {message}</div>")

@app.delete("/records/{record_id}", response_class=Response)
async def delete_record_endpoint(record_id: str):
    success, message = record_service.delete_record(record_id)
    if success:
        return Response(status_code=200, content="<div class='success'>ğŸ—‘ï¸ ÄÃ£ xÃ³a thÃ nh cÃ´ng.</div>")
    else:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i khi xÃ³a: {message}</div>", status_code=400)

def get_employee_display(employee_id, employees):
    """TÃ¬m vÃ  tráº£ vá» chuá»—i 'TÃªn (ID)' tá»« danh sÃ¡ch nhÃ¢n viÃªn."""
    if not employee_id or not employees:
        return ""
    for emp in employees:
        if emp.get('id') == employee_id:
            return f"{emp.get('name', '')} ({emp.get('id', '')})"
    return employee_id # Tráº£ vá» ID náº¿u khÃ´ng tÃ¬m tháº¥y

# â† THÃŠM Má»šI: Filter cho hiá»ƒn thá»‹ tÃªn nhÃ  cung cáº¥p
def get_transport_provider_display(provider_id, transport_providers):
    """TÃ¬m vÃ  tráº£ vá» tÃªn nhÃ  cung cáº¥p tá»« ID."""
    if not provider_id or not transport_providers:
        return provider_id
    for provider in transport_providers:
        if provider.get('id') == provider_id:
            return provider.get('name', provider_id)
    return provider_id # Tráº£ vá» ID náº¿u khÃ´ng tÃ¬m tháº¥y

templates.env.filters['get_employee_display'] = get_employee_display
templates.env.filters['get_transport_provider_display'] = get_transport_provider_display  # â† THÃŠM Má»šI

@app.post("/refresh-employees", response_class=HTMLResponse)
async def refresh_employees_endpoint():
    """Endpoint Ä‘á»ƒ lÃ m má»›i danh sÃ¡ch nhÃ¢n viÃªn"""
    try:
        import time
        time.sleep(0.5)  # Táº¡o cáº£m giÃ¡c xá»­ lÃ½
        
        success, message = employee_service.refresh_employees()
        
        if success:
            return HTMLResponse(f"<div class='success'>âœ… {message}</div>")
        else:
            return HTMLResponse(f"<div class='error'>âŒ Lá»—i: {message}</div>")
            
    except Exception as e:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i há»‡ thá»‘ng: {str(e)}</div>")

# â† THÃŠM Má»šI: Endpoint Ä‘á»ƒ refresh transport providers
@app.post("/refresh-transport-providers", response_class=HTMLResponse)
async def refresh_transport_providers_endpoint():
    """Endpoint Ä‘á»ƒ lÃ m má»›i danh sÃ¡ch Ä‘Æ¡n vá»‹ váº­n chuyá»ƒn"""
    try:
        import time
        time.sleep(0.5)  # Táº¡o cáº£m giÃ¡c xá»­ lÃ½
        
        # Báº¡n cáº§n thay "tblDefault" báº±ng table ID thá»±c táº¿ chá»©a nhÃ  cung cáº¥p
        # VÃ­ dá»¥: "tblXXXXXXXXXXXXXXX"
        success, message = transport_provider_service.refresh_transport_providers("tblyiELQIi6M1j1r")
        
        if success:
            return HTMLResponse(f"<div class='success'>âœ… {message}</div>")
        else:
            return HTMLResponse(f"<div class='error'>âŒ Lá»—i: {message}</div>")
            
    except Exception as e:
        return HTMLResponse(f"<div class='error'>âŒ Lá»—i há»‡ thá»‘ng: {str(e)}</div>")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)

============================================================

============================================================
FILE: README.md
============================================================
# ğŸ“¦ IMEX Distribution App

á»¨ng dá»¥ng Streamlit giÃºp kiá»ƒm tra tá»•ng requiredQuantity cá»§a 1 Bill ID IMEX tá»« API, nháº­p cÃ¡c thÃ´ng tin giao nháº­n vÃ  lÆ°u káº¿t quáº£ lÃªn Larkbase.

## ğŸš€ HÆ°á»›ng dáº«n cháº¡y nhanh

**Báº±ng Python:**

============================================================

============================================================
FILE: requirements.txt
============================================================
fastapi
uvicorn[standard]
python-multipart
jinja2
requests

============================================================

============================================================
FILE: services.py
============================================================
from src.utils.api import fetch_imex_details
from src.utils.larkbase import (
    larkbase_find_by_field, larkbase_write_data, 
    larkbase_update_data, larkbase_delete_record
)
from src.utils.cache import get_employee_list_from_file, update_employee_json_file
from src.utils.transport_provider import get_transport_providers_from_file, update_transport_providers_json_file
import time
import datetime
import logging

class RecordService:
    def __init__(self, app_token, table_id):
        self.app_token = app_token
        self.table_id = table_id

    def search_record(self, bill_id):
        """TÃ¬m kiáº¿m record theo Bill ID"""
        return larkbase_find_by_field(self.app_token, self.table_id, "ID", bill_id)

    # def create_record(self, form_data):
    #     """Táº¡o record má»›i"""
    #     new_record = {key: value for key, value in form_data.items()}
    #     new_record["NgÃ y bÃ n giao"] = int(time.time() * 1000)
    #     return larkbase_write_data(self.app_token, self.table_id, new_record)

    # def create_record(self, form_data):
    #     """Táº¡o record má»›i"""
    #     new_record = {}
        
    #     # Danh sÃ¡ch cÃ¡c trÆ°á»ng cáº§n chuyá»ƒn Ä‘á»•i thÃ nh sá»‘
    #     numeric_fields = ["Sá»‘ lÆ°á»£ng", "Sá»‘ lÆ°á»£ng bao/táº£i giao", "Sá»‘ lÆ°á»£ng bao táº£i nháº­n"]
        
    #     for key, value in form_data.items():
    #         if key in numeric_fields and value:
    #             try:
    #                 # Chuyá»ƒn Ä‘á»•i thÃ nh sá»‘ nguyÃªn
    #                 new_record[key] = int(value) if value else 0
    #             except (ValueError, TypeError):
    #                 # Náº¿u khÃ´ng chuyá»ƒn Ä‘á»•i Ä‘Æ°á»£c, máº·c Ä‘á»‹nh = 0
    #                 new_record[key] = 0
    #         else:
    #             new_record[key] = value
        
    #     new_record["NgÃ y bÃ n giao"] = int(time.time() * 1000)
        
    #     # Debug: In ra dá»¯ liá»‡u trÆ°á»›c khi gá»­i
    #     logging.info(f"Data to send: {new_record}")
    #     for key, value in new_record.items():
    #         logging.info(f"Field '{key}': {value} (type: {type(value)})")
        
    #     return larkbase_write_data(self.app_token, self.table_id, new_record)

    def create_record(self, form_data):
        """Táº¡o record má»›i vá»›i tÃ¡ch riÃªng ID vÃ  tÃªn tá»« dropdown"""
        new_record = {}
        
        # Danh sÃ¡ch cÃ¡c trÆ°á»ng cáº§n chuyá»ƒn Ä‘á»•i thÃ nh sá»‘
        numeric_fields = ["Sá»‘ lÆ°á»£ng", "Sá»‘ lÆ°á»£ng bao/táº£i giao", "Sá»‘ lÆ°á»£ng bao táº£i nháº­n"]
        
        # Debug: In ra toÃ n bá»™ form_data
        logging.info("=== FORM DATA DEBUG ===")
        for key, value in form_data.items():
            logging.info(f"Key: '{key}' = Value: '{value}'")
        logging.info("=== END DEBUG ===")
        
        for key, value in form_data.items():
            if key in numeric_fields and value:
                try:
                    new_record[key] = int(value) if value else 0
                except (ValueError, TypeError):
                    new_record[key] = 0
            elif key == "NgÆ°á»i bÃ n giao":  # â† Sá»¬A: Bá» "_tomselected"
                # ÄÃ¢y lÃ  giÃ¡ trá»‹ tá»« hidden input (chá»‰ chá»©a ID)
                if value:
                    # LÆ°u ID vÃ o cá»™t riÃªng
                    new_record["ID ngÆ°á»i bÃ n giao"] = value
                    
                    # TÃ¬m tÃªn tÆ°Æ¡ng á»©ng vá»›i ID tá»« danh sÃ¡ch nhÃ¢n viÃªn
                    from services import EmployeeService
                    employee_service = EmployeeService()
                    employees = employee_service.get_employees()
                    
                    employee_name = ""
                    for emp in employees:
                        if emp.get('id') == value:
                            employee_name = emp.get('name', '')
                            break
                    
                    if employee_name:
                        new_record["NgÆ°á»i bÃ n giao"] = employee_name
                    else:
                        new_record["NgÆ°á»i bÃ n giao"] = value  # Fallback vá» ID náº¿u khÃ´ng tÃ¬m tháº¥y tÃªn
                continue  # â† QUAN TRá»ŒNG: KhÃ´ng lÆ°u value gá»‘c
            elif value and key not in ["NgÆ°á»i bÃ n giao_hidden"]:  
                new_record[key] = value
        
        new_record["NgÃ y bÃ n giao"] = int(time.time() * 1000)
        
        # Debug: In ra dá»¯ liá»‡u trÆ°á»›c khi gá»­i
        logging.info(f"Data to send: {new_record}")
        
        return larkbase_write_data(self.app_token, self.table_id, new_record)


    def update_record(self, record_id, form_data):
        """Cáº­p nháº­t record vá»›i tÃ¡ch riÃªng ID vÃ  tÃªn tá»« dropdown"""
        from src.utils.config import UPDATABLE_FIELDS
        
        update_data = {}
        for field in UPDATABLE_FIELDS:
            if field in form_data and form_data[field]:
                value = form_data[field]
                
                if field == "NgÆ°á»i bÃ n giao":  # â† Sá»¬A: Bá» "_tomselected"
                    # LÆ°u ID
                    update_data["ID ngÆ°á»i bÃ n giao"] = value
                    
                    # TÃ¬m tÃªn tá»« danh sÃ¡ch nhÃ¢n viÃªn
                    from services import EmployeeService
                    employee_service = EmployeeService()
                    employees = employee_service.get_employees()
                    
                    employee_name = ""
                    for emp in employees:
                        if emp.get('id') == value:
                            employee_name = emp.get('name', '')
                            break
                    
                    if employee_name:
                        update_data["NgÆ°á»i bÃ n giao"] = employee_name
                    else:
                        update_data["NgÆ°á»i bÃ n giao"] = value
                elif field == "NgÃ y nháº­n hÃ ng" and value:
                    dt_obj = datetime.datetime.strptime(value, '%Y-%m-%d')
                    update_data[field] = int(dt_obj.timestamp() * 1000)
                else:
                    update_data[field] = value
        
        if not update_data:
            return False, "KhÃ´ng cÃ³ thÃ´ng tin nÃ o Ä‘Æ°á»£c thay Ä‘á»•i."
        
        return larkbase_update_data(self.app_token, self.table_id, record_id, update_data)




    def delete_record(self, record_id):
        """XÃ³a record"""
        return larkbase_delete_record(self.app_token, self.table_id, record_id)

    def get_api_data(self, bill_id):
        """Láº¥y dá»¯ liá»‡u tá»« API"""
        return fetch_imex_details(bill_id)

class EmployeeService:
    def get_employees(self):
        """Láº¥y danh sÃ¡ch nhÃ¢n viÃªn"""
        return get_employee_list_from_file()
    
    def refresh_employees(self):
        """LÃ m má»›i danh sÃ¡ch nhÃ¢n viÃªn"""
        return update_employee_json_file()



# ThÃªm class má»›i sau EmployeeService
class TransportProviderService:
    def __init__(self, app_token):
        self.app_token = app_token
    
    def get_transport_providers(self):
        """Láº¥y danh sÃ¡ch nhÃ  cung cáº¥p"""
        return get_transport_providers_from_file()
    
    def refresh_transport_providers(self, table_id="tblDefault"):
        """LÃ m má»›i danh sÃ¡ch nhÃ  cung cáº¥p"""
        return update_transport_providers_json_file(self.app_token, table_id)

============================================================

============================================================
FILE: src\utils\api.py
============================================================
import requests
import json
import logging

def fetch_imex_details(bill_id: int) -> list[dict] | None:
    url = "https://open.nhanh.vn/api/bill/imexrequirements"
    payload = {
        "version": "2.0",
        "appId": "74951",
        "businessId": "8901",
        "accessToken": "twf9P1xFZCUUgwt8zR0XgNeB6V5jsbq2KHb14bxovqK1ppCxyADwOK8FzQlCEeEGABRZINXoUCSzM50kjhwcrUSBWTY5nSvyhfnH2X2cI0pC7pNczSVxc1ratdDmxF85q7hUTUNCrUnpPTG5ZwLNO7bkMlEEJTCdPhgYaC",
        "data": json.dumps({"billId": int(bill_id)})
    }
    res = requests.post(url, data=payload)
    if res.status_code == 200:
        try:
            res_json = res.json()
            if res_json.get("code") == 1:
                data = res_json.get("data")
                if not data:
                    return None
                    
                imexs = data.get("imexs")
                if not imexs:
                    return None
                    
                result = []
                for item in imexs.values():
                    result.append({
                        "requiredQuantity": item.get("requiredQuantity", ""),
                        "damagedQuantity": item.get("damagedQuantity", ""),
                        "approvedQuantity": item.get("approvedQuantity", ""),
                        "realQuantity": item.get("realQuantity", ""),
                        "approvedByUser": item.get("approvedByUser", ""),
                        "requiredAt": item.get("requiredAt", ""),
                        "approvedAt": item.get("approvedAt", ""),
                        "confirmedAt": item.get("confirmedAt", ""),
                        "fromDepotId": item.get("fromDepotId", ""),
                        "fromDepotName": item.get("fromDepotName", ""),
                        "toDepotId": item.get("toDepotId", ""),
                        "toDepotName": item.get("toDepotName", "")
                    })
                return result
        except Exception as e:
            logging.error(f"Lá»—i khi parse JSON: {e}")
            return None
    return None

============================================================

============================================================
FILE: src\utils\cache.py
============================================================
# FILE: src/utils/cache.py

import requests
import logging
import json
import os

# --- Cáº¤U HÃŒNH ---
PERSONNEL_API_BASE_URL = "https://minham.1office.vn/api/personnel/profile/gets?access_token=4467770316793457d8e1ad273033229"
EMPLOYEE_JSON_PATH = "employees.json" # File JSON sáº½ Ä‘Æ°á»£c lÆ°u á»Ÿ thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n

logging.basicConfig(level=logging.INFO)


def update_employee_json_file():
    """
    Gá»i API 1Office Ä‘á»ƒ láº¥y danh sÃ¡ch nhÃ¢n viÃªn Ä‘ang hoáº¡t Ä‘á»™ng,
    bao gá»“m MÃ£ NV vÃ  PhÃ²ng ban, sau Ä‘Ã³ lÆ°u vÃ o file employees.json.
    Tráº£ vá» (bool, message).
    """
    logging.info("Báº¯t Ä‘áº§u quÃ¡ trÃ¬nh cáº­p nháº­t danh sÃ¡ch nhÃ¢n viÃªn tá»« 1Office...")
    all_employees_raw = []
    page = 1

    while True:
        url = f"{PERSONNEL_API_BASE_URL}&page={page}"
        try:
            response = requests.get(url, timeout=20)
            response.raise_for_status()
            json_data = response.json()

            if not json_data or not json_data.get("data"):
                logging.info(f"KhÃ´ng cÃ³ thÃªm dá»¯ liá»‡u á»Ÿ trang {page}, dá»«ng vÃ²ng láº·p.")
                break

            current_page_data = json_data['data']
            all_employees_raw.extend(current_page_data)
            logging.info(f"ÄÃ£ láº¥y thÃ nh cÃ´ng trang {page} vá»›i {len(current_page_data)} báº£n ghi.")
            page += 1
            # ThÃªm má»™t khoáº£ng nghá»‰ nhá» Ä‘á»ƒ trÃ¡nh gÃ¢y quÃ¡ táº£i cho API
            # time.sleep(0.1) 

        except requests.exceptions.RequestException as e:
            msg = f"Lá»—i khi gá»i API 1Office á»Ÿ trang {page}: {e}"
            logging.error(msg)
            return False, msg
        except ValueError:
            msg = f"Lá»—i: KhÃ´ng thá»ƒ phÃ¢n tÃ­ch JSON tá»« API á»Ÿ trang {page}."
            logging.error(msg)
            return False, msg

    # Lá»c vÃ  Ä‘á»‹nh dáº¡ng láº¡i dá»¯ liá»‡u, láº¥y thÃªm phÃ²ng ban
    active_employees = []
    for emp in all_employees_raw:
        # Chá»‰ láº¥y nhÃ¢n viÃªn Ä‘ang hoáº¡t Ä‘á»™ng vÃ  cÃ³ Ä‘á»§ thÃ´ng tin cáº§n thiáº¿t
        if emp.get("job_date_out") == "" and emp.get("code") and emp.get("name"):
            active_employees.append({
                "id": emp.get("code"),
                "name": emp.get("name"),
                "department": emp.get("department_id")
            })
    
    # Sáº¯p xáº¿p danh sÃ¡ch theo tÃªn Ä‘á»ƒ dá»… tÃ¬m kiáº¿m
    active_employees.sort(key=lambda x: x['name'])

    # Ghi ra file JSON
    try:
        with open(EMPLOYEE_JSON_PATH, 'w', encoding='utf-8') as f:
            json.dump(active_employees, f, ensure_ascii=False, indent=4)
        msg = f"Cáº­p nháº­t thÃ nh cÃ´ng! ÄÃ£ lÆ°u {len(active_employees)} nhÃ¢n viÃªn vÃ o file {EMPLOYEE_JSON_PATH}."
        logging.info(msg)
        return True, msg
    except IOError as e:
        msg = f"Lá»—i khi ghi file {EMPLOYEE_JSON_PATH}: {e}"
        logging.error(msg)
        return False, msg


def get_employee_list_from_file():
    """
    Äá»c danh sÃ¡ch nhÃ¢n viÃªn trá»±c tiáº¿p tá»« file employees.json.
    Náº¿u file khÃ´ng tá»“n táº¡i, thá»­ táº¡o nÃ³ láº§n Ä‘áº§u.
    """
    if not os.path.exists(EMPLOYEE_JSON_PATH):
        logging.warning(f"File {EMPLOYEE_JSON_PATH} khÃ´ng tá»“n táº¡i. Äang thá»­ táº¡o láº§n Ä‘áº§u tiÃªn...")
        success, message = update_employee_json_file()
        if not success:
            # Náº¿u táº¡o file tháº¥t báº¡i, tráº£ vá» danh sÃ¡ch rá»—ng
            return []

    try:
        with open(EMPLOYEE_JSON_PATH, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (IOError, json.JSONDecodeError) as e:
        logging.error(f"Lá»—i khi Ä‘á»c hoáº·c phÃ¢n tÃ­ch file {EMPLOYEE_JSON_PATH}: {e}")
        return [] # Tráº£ vá» rá»—ng náº¿u file bá»‹ lá»—i


============================================================

============================================================
FILE: src\utils\config.py
============================================================
# src/utils/config.py

# Danh sÃ¡ch cá»™t hiá»ƒn thá»‹ trong form (theo thá»© tá»± mong muá»‘n)
LARKBASE_FIELDS = [
    "ID",
    "ID kho Ä‘i",
    "Kho Ä‘i", 
    "ID kho Ä‘áº¿n",
    "Kho Ä‘áº¿n",
    "Sá»‘ lÆ°á»£ng bao/táº£i giao", 
    "ID ngÆ°á»i bÃ n giao",
    "NgÆ°á»i bÃ n giao",
    "NgÃ y bÃ n giao",
    "ÄÆ¡n vá»‹ váº­n chuyá»ƒn",
    "Sá»‘ lÆ°á»£ng bao táº£i nháº­n",
    "NgÆ°á»i nháº­n", 
    "NgÃ y nháº­n hÃ ng",
    "Thiáº¿u thá»«a bao"
]

# === QUY Táº®C NHáº¬P LIá»†U ===

# CÃ¡c trÆ°á»ng ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ nháº­p liá»‡u khi Táº O Má»šI báº£n ghi.
CREATABLE_FIELDS = [
    "Sá»‘ lÆ°á»£ng bao/táº£i giao",
    "NgÆ°á»i bÃ n giao",
    "ÄÆ¡n vá»‹ váº­n chuyá»ƒn"
]

# CÃ¡c trÆ°á»ng ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ nháº­p liá»‡u khi Cáº¬P NHáº¬T báº£n ghi.
UPDATABLE_FIELDS = [
    "Sá»‘ lÆ°á»£ng bao/táº£i giao",
    "NgÆ°á»i bÃ n giao",
    "ÄÆ¡n vá»‹ váº­n chuyá»ƒn"
]

# CÃ¡c trÆ°á»ng khi Ä‘Ã£ cÃ³ dá»¯ liá»‡u sáº½:
# 1. Tá»± khÃ³a chÃ­nh nÃ³, khÃ´ng cho sá»­a ná»¯a.
# 2. KhÃ³a khÃ´ng cho xÃ³a toÃ n bá»™ báº£n ghi.
LOCK_FIELDS = [
    "Sá»‘ lÆ°á»£ng bao táº£i nháº­n",
    "NgÆ°á»i nháº­n",
    "NgÃ y nháº­n hÃ ng"
]

# === Dá»® LIá»†U Ná»€N ===

# CÃ¡c cá»™t láº¥y tá»« API (khÃ´ng hiá»ƒn thá»‹ trong form nhÆ°ng váº«n lÆ°u vÃ o database)
API_FIELDS = [
    "ID kho Ä‘i", "Kho Ä‘i", "ID kho Ä‘áº¿n", "Kho Ä‘áº¿n", "Sá»‘ lÆ°á»£ng", 
    "Sá»‘ lÆ°á»£ng sáº£n pháº©m yÃªu cáº§u", "Sá»‘ lÆ°á»£ng sáº£n pháº©m há»ng", 
    "Sá»‘ lÆ°á»£ng sáº£n pháº©m yÃªu cáº§u Ä‘Æ°á»£c duyá»‡t", "Sá»‘ lÆ°á»£ng sáº£n pháº©m yÃªu cáº§u Ä‘Æ°á»£c xÃ¡c nháº­n", 
    "NgÃ y táº¡o", "NgÃ y duyá»‡t", "NgÃ y xÃ¡c nháº­n", "NgÆ°á»i xÃ¡c nháº­n"
]

# ToÃ n bá»™ fields Ä‘á»ƒ lÆ°u vÃ o Larkbase (hiá»‡n khÃ´ng dÃ¹ng trong app.py)
ALL_LARKBASE_FIELDS = LARKBASE_FIELDS + API_FIELDS

============================================================

============================================================
FILE: src\utils\larkbase.py
============================================================
# FILE: src/utils/larkbase.py

import requests
import logging

# Thiáº¿t láº­p logging cÆ¡ báº£n
logging.basicConfig(level=logging.INFO)

API_ENDPOINT = 'https://open.larksuite.com/open-apis'
API_HOST = "https://open.larksuite.com/open-apis/bitable/v1/apps"

def larkbase_get_token(app_id=None, app_secret=None, endpoint=API_ENDPOINT):
    APP_ID = app_id or 'cli_a7fab27260385010'
    APP_SECRET = app_secret or 'Zg4MVcFfiOu0g09voTcpfd4WGDpA0Ly5'
    url = f"{endpoint}/auth/v3/tenant_access_token/internal"
    try:
        resp = requests.post(url, json={'app_id': APP_ID, 'app_secret': APP_SECRET})
        if resp.status_code == 200:
            data = resp.json()
            if data.get('code') == 0:
                return data['tenant_access_token']
    except Exception as e:
        logging.error(f"Lá»—i khi láº¥y token: {e}")
    return None

def get_headers(token):
    return {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

def larkbase_get_all(app_token, table_id):
    token = larkbase_get_token()
    if not token:
        logging.error("KhÃ´ng xÃ¡c thá»±c Ä‘Æ°á»£c vá»›i Larkbase.")
        return []

    all_records = []
    page_token = ""
    while True:
        try:
            url = f"{API_HOST}/{app_token}/tables/{table_id}/records?page_size=500"
            if page_token:
                url += f"&page_token={page_token}"
            
            resp = requests.get(url, headers=get_headers(token))
            if resp.status_code != 200:
                logging.error(f"API tráº£ vá» status code: {resp.status_code}")
                break
            
            res_data = resp.json()
            if res_data.get("code") != 0:
                logging.error(f"API tráº£ vá» code: {res_data.get('code')}, msg: {res_data.get('msg', '')}")
                break

            data = res_data.get("data")
            if not data:  # âœ… Kiá»ƒm tra data trÆ°á»›c
                break
                
            items = data.get("items", [])
            if not items:  # âœ… Kiá»ƒm tra items trÆ°á»›c
                break
                
            all_records.extend(items)
            
            page_token = data.get("page_token", "")
            if not page_token:
                break
                
        except Exception as e:
            logging.error(f"Lá»—i khi láº¥y dá»¯ liá»‡u: {e}")
            break
    return all_records



def larkbase_find_by_field(app_token, table_id, field, value):
    all_records = larkbase_get_all(app_token, table_id)
    if not all_records:
        # Tráº£ vá» tuple (tráº¡ng thÃ¡i, dá»¯ liá»‡u)
        return False, None
    for record in all_records:
        fields = record.get('fields', {})
        if str(fields.get(field, '')).strip() == str(value).strip():
            # TÃ¬m tháº¥y, tráº£ vá» (True, record)
            return True, record
    # KhÃ´ng tÃ¬m tháº¥y sau khi duyá»‡t háº¿t, tráº£ vá» (False, None)
    return False, None


def larkbase_write_data(app_token, table_id, data):
    """Ghi dá»¯ liá»‡u má»›i vÃ  tráº£ vá» (bool, message)"""
    token = larkbase_get_token()
    if not token:
        return False, "KhÃ´ng thá»ƒ xÃ¡c thá»±c vá»›i Larkbase."
    try:
        url = f"{API_HOST}/{app_token}/tables/{table_id}/records"
        resp = requests.post(url, headers=get_headers(token), json={"fields": data})
        res_json = resp.json()
        if resp.status_code == 200 and res_json.get('code') == 0:
            return True, "ThÃªm má»›i thÃ nh cÃ´ng"
        else:
            error_msg = res_json.get('msg', resp.text)
            logging.error(f"Lá»—i API khi ghi: {error_msg}")
            return False, error_msg
    except Exception as e:
        logging.error(f"Lá»—i ngoáº¡i lá»‡ khi ghi dá»¯ liá»‡u: {e}")
        return False, str(e)

def larkbase_update_data(app_token, table_id, record_id, data):
    """Cáº­p nháº­t dá»¯ liá»‡u vÃ  tráº£ vá» (bool, message)"""
    token = larkbase_get_token()
    if not token:
        return False, "KhÃ´ng thá»ƒ xÃ¡c thá»±c vá»›i Larkbase."
    try:
        url = f"{API_HOST}/{app_token}/tables/{table_id}/records/{record_id}"
        resp = requests.put(url, headers=get_headers(token), json={"fields": data})
        res_json = resp.json()
        if resp.status_code == 200 and res_json.get('code') == 0:
            return True, "Cáº­p nháº­t thÃ nh cÃ´ng"
        else:
            error_msg = res_json.get('msg', resp.text)
            logging.error(f"Lá»—i API khi cáº­p nháº­t: {error_msg}")
            return False, error_msg
    except Exception as e:
        logging.error(f"Lá»—i ngoáº¡i lá»‡ khi cáº­p nháº­t: {e}")
        return False, str(e)

def larkbase_delete_record(app_token, table_id, record_id):
    """XÃ³a má»™t báº£n ghi vÃ  tráº£ vá» (bool, message)"""
    token = larkbase_get_token()
    if not token:
        return False, "KhÃ´ng thá»ƒ xÃ¡c thá»±c vá»›i Larkbase."
    try:
        url = f"{API_HOST}/{app_token}/tables/{table_id}/records/{record_id}"
        resp = requests.delete(url, headers=get_headers(token))
        res_json = resp.json()
        if resp.status_code == 200 and res_json.get('code') == 0:
            return True, "XÃ³a thÃ nh cÃ´ng"
        else:
            error_msg = res_json.get('msg', resp.text)
            logging.error(f"Lá»—i API khi xÃ³a: {error_msg}")
            return False, error_msg
    except Exception as e:
        logging.error(f"Lá»—i ngoáº¡i lá»‡ khi xÃ³a: {e}")
        return False, str(e)

============================================================

============================================================
FILE: src\utils\transport_provider.py
============================================================
# FILE: src/utils/transport_provider.py

from src.utils.larkbase import larkbase_get_all
import logging
import json
import os

# Cáº¥u hÃ¬nh
PROJECT_ROOT = os.path.abspath(os.path.join(os.path.dirname(__file__), '..', '..'))
TRANSPORT_PROVIDERS_JSON_PATH = os.path.join(PROJECT_ROOT, "transport_providers.json")

def get_transport_providers_from_larkbase(app_token, table_id="tblDefault"):
    """
    Láº¥y danh sÃ¡ch nhÃ  cung cáº¥p tá»« Larkbase
    """
    try:
        all_records = larkbase_get_all(app_token, table_id)
        if not all_records:
            logging.error("KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u tá»« báº£ng nhÃ  cung cáº¥p")
            return []
        
        providers = []
        for record in all_records:
            fields = record.get('fields', {})
            provider_name = fields.get('TÃªn nhÃ  cung cáº¥p', '').strip()
            
            if provider_name:  # Chá»‰ láº¥y nhá»¯ng record cÃ³ tÃªn
                providers.append({
                    "id": provider_name,  # Sá»­ dá»¥ng tÃªn lÃ m ID
                    "name": provider_name
                })
        
        # Loáº¡i bá» trÃ¹ng láº·p vÃ  sáº¯p xáº¿p
        unique_providers = []
        seen_names = set()
        
        for provider in providers:
            if provider['name'] not in seen_names:
                unique_providers.append(provider)
                seen_names.add(provider['name'])
        
        # Sáº¯p xáº¿p theo tÃªn
        unique_providers.sort(key=lambda x: x['name'])
        
        return unique_providers
        
    except Exception as e:
        logging.error(f"Lá»—i khi láº¥y danh sÃ¡ch nhÃ  cung cáº¥p: {e}")
        return []

def update_transport_providers_json_file(app_token, table_id="tblDefault"):
    """
    Cáº­p nháº­t file JSON chá»©a danh sÃ¡ch nhÃ  cung cáº¥p
    """
    try:
        providers = get_transport_providers_from_larkbase(app_token, table_id)
        
        if not providers:
            return False, "KhÃ´ng láº¥y Ä‘Æ°á»£c danh sÃ¡ch nhÃ  cung cáº¥p tá»« Larkbase"
        
        # Ghi vÃ o file JSON
        with open(TRANSPORT_PROVIDERS_JSON_PATH, 'w', encoding='utf-8') as f:
            json.dump(providers, f, ensure_ascii=False, indent=4)
        
        msg = f"Cáº­p nháº­t thÃ nh cÃ´ng! ÄÃ£ lÆ°u {len(providers)} nhÃ  cung cáº¥p vÃ o file {TRANSPORT_PROVIDERS_JSON_PATH}."
        logging.info(msg)
        return True, msg
        
    except Exception as e:
        msg = f"Lá»—i khi cáº­p nháº­t file nhÃ  cung cáº¥p: {e}"
        logging.error(msg)
        return False, msg

def get_transport_providers_from_file():
    """
    Äá»c danh sÃ¡ch nhÃ  cung cáº¥p tá»« file JSON
    """
    if not os.path.exists(TRANSPORT_PROVIDERS_JSON_PATH):
        logging.warning(f"File {TRANSPORT_PROVIDERS_JSON_PATH} khÃ´ng tá»“n táº¡i.")
        return []
    
    try:
        with open(TRANSPORT_PROVIDERS_JSON_PATH, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (IOError, json.JSONDecodeError) as e:
        logging.error(f"Lá»—i khi Ä‘á»c file {TRANSPORT_PROVIDERS_JSON_PATH}: {e}")
        return []

============================================================

============================================================
FILE: static\app.js
============================================================
document.addEventListener('DOMContentLoaded', () => {

    // --- LOGIC CHO POPUP NOTIFICATION --- (Giá»¯ nguyÃªn, váº«n cÃ³ thá»ƒ há»¯u Ã­ch)
    function showNotification(message, type = 'success', duration = 3000) {
        const notification = document.createElement('div');
        notification.className = `notification-popup ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => { notification.classList.add('show'); }, 100);
        
        setTimeout(() => {
            notification.classList.add('hide');
            notification.addEventListener('transitionend', () => notification.remove());
        }, duration);
    }

    // âœ… THÃŠM: HÃ m hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i validation
    function showValidationError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'validation-error';
        errorDiv.textContent = message;
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f44336;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 10000;
            font-size: 14px;
        `;
        
        document.body.appendChild(errorDiv);
        
        setTimeout(() => {
            errorDiv.remove();
        }, 3000);
    }
    
    // --- LOGIC Cáº¢I TIáº¾N CHO EMPLOYEE DROPDOWN ---
    function initEmployeeDropdown(component) {
        const searchInput = component.querySelector('.employee-search-input');
        const hiddenInput = component.querySelector('.employee-hidden-input');
        const dropdown = component.querySelector('.employee-dropdown');
        const options = dropdown.querySelectorAll('.employee-option');
        const infoDiv = dropdown.querySelector('.employee-dropdown-info');

        if (!searchInput || !hiddenInput || !dropdown || !infoDiv) return;
        
        // áº¨n dropdown ban Ä‘áº§u
        dropdown.style.display = 'none';
        
        // Hiá»ƒn thá»‹ giÃ¡ trá»‹ cÃ³ sáºµn (náº¿u Ä‘ang edit)
        if (hiddenInput.value) {
            const selectedOption = dropdown.querySelector(`[data-value="${hiddenInput.value}"]`);
            if (selectedOption) {
                const employeeName = selectedOption.dataset.name;
                const employeeId = selectedOption.dataset.value;
                searchInput.value = `${employeeName} (${employeeId})`;
                selectedOption.classList.add('selected');
            }
        }
        
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            
            // Chá»‰ hiá»‡n dropdown khi gÃµ Ã­t nháº¥t 1 kÃ½ tá»±
            if (query.length < 1) {
                dropdown.style.display = 'none';
                hiddenInput.value = '';
                return;
            }
            
            dropdown.style.display = 'block';
            filterEmployees(query);
        });

        // âœ… Sá»¬A: ThÃªm validation khi blur - chá»‰ cháº·n khi khÃ´ng há»£p lá»‡
        searchInput.addEventListener('blur', () => {
            setTimeout(() => {
                // Náº¿u input cÃ³ giÃ¡ trá»‹ nhÆ°ng hiddenInput rá»—ng = nháº­p sai
                if (searchInput.value.trim() && !hiddenInput.value) {
                    searchInput.value = ''; // Reset input
                    showValidationError('Vui lÃ²ng chá»n nhÃ¢n viÃªn tá»« danh sÃ¡ch');
                }
                dropdown.style.display = 'none';
            }, 200);
        });

        // Hiá»‡n dropdown khi focus vÃ o input (náº¿u Ä‘Ã£ cÃ³ ná»™i dung)
        searchInput.addEventListener('focus', () => {
            const query = searchInput.value.trim().toLowerCase();
            if (query.length >= 1) {
                dropdown.style.display = 'block';
                filterEmployees(query);
            }
        });

        dropdown.addEventListener('click', (e) => {
            const option = e.target.closest('.employee-option');
            if (option) {
                const employeeId = option.dataset.value;
                const employeeName = option.dataset.name;

                searchInput.value = `${employeeName} (${employeeId})`;
                hiddenInput.value = employeeId;
                dropdown.style.display = 'none';

                // XÃ³a class selected cÅ© vÃ  thÃªm cho option Ä‘Æ°á»£c chá»n
                options.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
            }
        });
        
        function filterEmployees(query) {
            let visibleCount = 0;
            const maxResults = 5; // Giá»›i háº¡n chá»‰ 5 káº¿t quáº£
            
            options.forEach(option => {
                const name = option.dataset.name.toLowerCase();
                const id = option.dataset.value.toLowerCase();
                const department = option.dataset.department.toLowerCase();
                
                const isMatch = name.includes(query) || id.includes(query) || department.includes(query);
                
                if (isMatch && visibleCount < maxResults) {
                    option.style.display = 'block';
                    visibleCount++;
                } else {
                    option.style.display = 'none';
                }
            });
            
            // Cáº­p nháº­t thÃ´ng tin sá»‘ káº¿t quáº£
            if (visibleCount === 0) {
                infoDiv.innerHTML = '<small style="color: #c62828;">KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p</small>';
            } else if (visibleCount >= maxResults) {
                infoDiv.innerHTML = `<small>Hiá»ƒn thá»‹ ${maxResults} káº¿t quáº£ Ä‘áº§u tiÃªn. GÃµ thÃªm Ä‘á»ƒ thu háº¹p.</small>`;
            } else {
                infoDiv.innerHTML = `<small>TÃ¬m tháº¥y ${visibleCount} káº¿t quáº£</small>`;
            }
        }
    }

    // --- LOGIC CHO TRANSPORT DROPDOWN (ÄÃƒ Sá»¬A) ---
    function initTransportDropdown(component) {
        const searchInput = component.querySelector('.transport-search-input');
        const hiddenInput = component.querySelector('.transport-hidden-input');
        const dropdown = component.querySelector('.transport-dropdown');
        const options = dropdown.querySelectorAll('.transport-option');
        const infoDiv = dropdown.querySelector('.transport-dropdown-info');

        if (!searchInput || !hiddenInput || !dropdown || !infoDiv) return;
        
        // âœ… Sá»¬A: áº¨n dropdown ban Ä‘áº§u báº±ng class
        dropdown.classList.remove('show');
        
        // Hiá»ƒn thá»‹ giÃ¡ trá»‹ cÃ³ sáºµn (náº¿u Ä‘ang edit)
        if (hiddenInput.value) {
            const selectedOption = dropdown.querySelector(`[data-value="${hiddenInput.value}"]`);
            if (selectedOption) {
                searchInput.value = selectedOption.dataset.name;
                selectedOption.classList.add('selected');
            }
        }
        
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            
            if (query.length < 1) {
                dropdown.classList.remove('show'); // âœ… Sá»¬A
                hiddenInput.value = '';
                return;
            }
            
            dropdown.classList.add('show'); // âœ… Sá»¬A
            filterTransportProviders(query);
        });

        // âœ… Sá»¬A: ThÃªm validation khi blur - chá»‰ cháº·n khi khÃ´ng há»£p lá»‡
        searchInput.addEventListener('blur', () => {
            setTimeout(() => {
                // Náº¿u input cÃ³ giÃ¡ trá»‹ nhÆ°ng hiddenInput rá»—ng = nháº­p sai
                if (searchInput.value.trim() && !hiddenInput.value) {
                    searchInput.value = ''; // Reset input
                    showValidationError('Vui lÃ²ng chá»n Ä‘Æ¡n vá»‹ váº­n chuyá»ƒn tá»« danh sÃ¡ch');
                }
                dropdown.classList.remove('show');
            }, 200);
        });

        searchInput.addEventListener('focus', () => {
            const query = searchInput.value.trim().toLowerCase();
            if (query.length >= 1) {
                dropdown.classList.add('show'); // âœ… Sá»¬A
                filterTransportProviders(query);
            }
        });

        dropdown.addEventListener('click', (e) => {
            const option = e.target.closest('.transport-option');
            if (option) {
                const providerId = option.dataset.value;
                const providerName = option.dataset.name;

                searchInput.value = providerName;
                hiddenInput.value = providerId;
                dropdown.classList.remove('show'); // âœ… Sá»¬A

                options.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
            }
        });
        
        function filterTransportProviders(query) {
            let visibleCount = 0;
            const maxResults = 5;
            
            options.forEach(option => {
                const name = option.dataset.name.toLowerCase();
                const isMatch = name.includes(query);
                
                if (isMatch && visibleCount < maxResults) {
                    option.style.display = 'block';
                    visibleCount++;
                } else {
                    option.style.display = 'none';
                }
            });
            
            if (visibleCount === 0) {
                infoDiv.innerHTML = '<small style="color: #c62828;">KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p</small>';
            } else if (visibleCount >= maxResults) {
                infoDiv.innerHTML = `<small>Hiá»ƒn thá»‹ ${maxResults} káº¿t quáº£ Ä‘áº§u tiÃªn. GÃµ thÃªm Ä‘á»ƒ thu háº¹p.</small>`;
            } else {
                infoDiv.innerHTML = `<small>TÃ¬m tháº¥y ${visibleCount} káº¿t quáº£</small>`;
            }
        }
    }

    // Khá»Ÿi táº¡o cho táº¥t cáº£ dropdown cÃ³ sáºµn khi táº£i trang
    document.querySelectorAll('.employee-dropdown-component').forEach(initEmployeeDropdown);
    document.querySelectorAll('.transport-dropdown-component').forEach(initTransportDropdown);

    // âœ… Sá»¬A: áº¨n dropdown náº¿u click ra ngoÃ i (tÆ°Æ¡ng thÃ­ch cáº£ hai phÆ°Æ¡ng phÃ¡p)
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.employee-search') && !e.target.closest('.transport-search')) {
            // Employee váº«n dÃ¹ng style.display
            document.querySelectorAll('.employee-dropdown').forEach(dd => {
                dd.style.display = 'none';
            });
            // Transport dÃ¹ng class
            document.querySelectorAll('.transport-dropdown').forEach(dd => {
                dd.classList.remove('show');
            });
        }
    });

    // --- Xá»¬ LÃ HTMX RESPONSE ---
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.failed) {
            console.error("YÃªu cáº§u HTMX tháº¥t báº¡i:", evt.detail.xhr);
        }
    });
    
    // Khá»Ÿi táº¡o láº¡i JS cho dropdown khi HTMX swap ná»™i dung má»›i vÃ o
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        evt.detail.target.querySelectorAll('.employee-dropdown-component').forEach(initEmployeeDropdown);
        evt.detail.target.querySelectorAll('.transport-dropdown-component').forEach(initTransportDropdown);
    });
});

============================================================

============================================================
FILE: static\style.css
============================================================
/* ======================================== */
/* FILE: static/style.css (ÄÃƒ Cáº¬P NHáº¬T)     */
/* ======================================== */

/* --- PHONG CÃCH CÆ  Báº¢N --- */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    background-color: #f5f5f5;
    color: #333;
    line-height: 1.5;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 24px;
}

.title {
    text-align: center;
    color: #1976d2;
    margin-bottom: 32px;
    font-size: 24px;
    font-weight: 400;
}

/* --- FORM --- */
.search-form {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
}

.form-group {
    margin-bottom: 16px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #555;
    font-size: 14px;
}

/* ÄÃƒ Sá»¬A: Äáº£m báº£o táº¥t cáº£ input vÃ  button cÃ³ cÃ¹ng chiá»u rá»™ng */
.form-control,
.search-input,
.employee-search-input,
.transport-search-input,
.btn {
    width: 100% !important;
    box-sizing: border-box;
}

.form-control,
.search-input {
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    transition: border-color 0.2s;
}

.form-control:focus,
.search-input:focus {
    outline: none;
    border-color: #1976d2;
    box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
}

/* --- DROPDOWN NHÃ‚N VIÃŠN --- */
.employee-dropdown-component {
    width: 100%;
}

.employee-search {
    position: relative;
    width: 100%;
}

.employee-search-input {
    width: 100% !important;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    transition: border-color 0.2s;
}

.employee-search-input:focus {
    outline: none;
    border-color: #1976d2;
    box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
}

.employee-dropdown {
    display: none; /* áº¨n máº·c Ä‘á»‹nh */
    position: absolute;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    width: 100%;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin-top: 2px;
}

.employee-option {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    font-size: 14px;
}

.employee-option:hover {
    background-color: #f5f5f5;
}

.employee-option:last-child {
    border-bottom: none;
}

.employee-option small {
    font-size: 11px;
    color: #666;
    display: block;
    margin-top: 2px;
}

.employee-option.selected {
    background-color: #e3f2fd;
}

.employee-dropdown-info {
    padding: 8px 16px;
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    text-align: center;
    font-style: italic;
    color: #6c757d;
}

/* --- DROPDOWN ÄÆ NVá»Š Váº¬N CHUYá»‚N (ÄÃƒ Sá»¬A) --- */
.transport-dropdown-component {
    width: 100%;
}

.transport-search {
    position: relative;
    width: 100%;
}

.transport-search-input {
    width: 100% !important;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    transition: border-color 0.2s;
}

.transport-search-input:focus {
    outline: none;
    border-color: #1976d2;
    box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
}

/* âœ… Sá»¬A: Bá» !important vÃ  dÃ¹ng class-based approach */
.transport-dropdown {
    display: none; /* KhÃ´ng dÃ¹ng !important ná»¯a */
    position: absolute;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 9999;
    width: 100%;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin-top: 2px;
}

/* âœ… Sá»¬A: DÃ¹ng class 'show' thay vÃ¬ 'visible' Ä‘á»ƒ Ä‘á»“ng nháº¥t vá»›i employee dropdown */
.transport-dropdown.show {
    display: block !important;
}

.transport-option {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    font-size: 14px;
    transition: background-color 0.2s ease;
}

.transport-option:hover {
    background-color: #f5f5f5;
}

.transport-option:last-child {
    border-bottom: none;
}

.transport-option.selected {
    background-color: #e3f2fd;
    font-weight: 500;
}

.transport-dropdown-info {
    padding: 8px 16px;
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    text-align: center;
    font-style: italic;
    color: #6c757d;
    font-size: 12px;
}

/* âœ… THÃŠM: Äáº£m báº£o dropdown hiá»ƒn thá»‹ Ä‘Ãºng khi cÃ³ nhiá»u options */
.transport-dropdown::-webkit-scrollbar {
    width: 6px;
}

.transport-dropdown::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.transport-dropdown::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.transport-dropdown::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}


/* ============================================================ */
/* --- KHU Vá»°C HIá»†U á»¨NG LOADING Äá»’NG Bá»˜ ---                    */
/* ============================================================ */

/* 1. KEYFRAMES ANIMATION XOAY (SPIN) DÃ™NG CHUNG */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* 2. SPINNER DÃ™NG CHUNG */
.spinner {
    display: inline-block;
    width: 18px;
    height: 18px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    vertical-align: middle;
}

/* 3. STYLE CHUNG CHO CÃC NÃšT KHI LOADING */
.btn,
button {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* VÃ´ hiá»‡u hÃ³a nÃºt vÃ  giáº£m Ä‘á»™ má» khi Ä‘ang xá»­ lÃ½ request */
.btn.htmx-request,
button.htmx-request {
    cursor: not-allowed;
    opacity: 0.8;
}

/* áº¨n vÄƒn báº£n/icon gá»‘c cá»§a nÃºt khi Ä‘ang loading */
.htmx-request .btn-text {
    display: none;
}

/* Hiá»ƒn thá»‹ khu vá»±c indicator (chá»©a spinner) bÃªn trong nÃºt khi loading */
.htmx-request .htmx-indicator {
    display: inline-block !important;
}

/* 4. STYLE CHO CÃC LOáº I NÃšT Cá»¤ THá»‚ */
.btn {
    padding: 12px 16px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    width: 100% !important;
    min-width: unset;
    white-space: nowrap;
}

.btn-primary {
    background-color: #1976d2;
    color: white;
}

.btn-primary:hover {
    background-color: #1565c0;
}

.btn-success {
    background-color: #388e3c;
    color: white;
}

.btn-success:hover {
    background-color: #2e7d32;
}

.btn-danger {
    background-color: #d32f2f;
    color: white;
}

.btn-danger:hover {
    background-color: #c62828;
}

/* 5. STYLE Má»šI CHO NÃšT REFRESH */
.btn-refresh,
.form-btn-refresh,
.form-btn-refresh-transport {
    width: 100% !important;
    min-width: unset;
    white-space: nowrap;
    padding: 12px 16px;
    height: auto;
}

/* Container cho nÃºt refresh */
.refresh-container {
    width: 100%;
    margin-bottom: 16px;
}

.refresh-status-container {
    font-size: 12px;
    margin-top: 4px;
    min-height: 18px;
    text-align: center;
    padding-right: 0;
}

/* Spinner trong nÃºt refresh */
.btn-refresh .spinner,
.form-btn-refresh .spinner,
.form-btn-refresh-transport .spinner {
    width: 14px;
    height: 14px;
    border-width: 2px;
    border-top-color: #fff;
}

/* Hover effect cho nÃºt refresh */
.btn-refresh:hover,
.form-btn-refresh:hover,
.form-btn-refresh-transport:hover {
    background-color: rgba(25, 118, 210, 0.8);
}

/* ÄÃƒ THÃŠM: Äáº£m báº£o cÃ¡c nÃºt submit cÅ©ng full width */
.form-actions {
    width: 100%;
}

.form-actions .btn {
    width: 100%;
    margin-bottom: 8px;
}

/* Náº¿u cÃ³ nhiá»u nÃºt trong 1 hÃ ng, cÃ³ thá»ƒ dÃ¹ng flex */
.btn-group {
    display: flex;
    gap: 8px;
    width: 100%;
}

.btn-group .btn {
    flex: 1;
}

/* 6. VÃ” HIá»†U HÃ“A INDICATOR Dáº NG THANH BAR TOÃ€N Cá»¤C - ÄÃƒ Sá»¬A */
/* Chá»‰ áº©n global indicators, khÃ´ng áº£nh hÆ°á»Ÿng button indicators */
#htmx-indicator,
.htmx-indicator.global {
    display: none;
}

/* Äáº£m báº£o button indicators váº«n hoáº¡t Ä‘á»™ng */
.btn .htmx-indicator,
button .htmx-indicator {
    display: none; /* áº¨n máº·c Ä‘á»‹nh */
}

.btn.htmx-request .htmx-indicator,
button.htmx-request .htmx-indicator {
    display: inline-block !important; /* Hiá»‡n khi loading */
}

/* --- CÃC STYLE KHÃC --- */
.success,
.error,
.info {
    padding: 12px 16px;
    border-radius: 4px;
    margin: 16px 0;
}

.success {
    background-color: #e8f5e8;
    color: #2e7d32;
    border-left: 4px solid #4caf50;
}

.error {
    background-color: #ffebee;
    color: #c62828;
    border-left: 4px solid #f44336;
}

.info {
    background-color: #e3f2fd;
    color: #1565c0;
    border-left: 4px solid #2196f3;
}

.elevation-1 {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
}

/* Popup notification styles */
.notification-popup {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    padding: 16px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateX(400px);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    max-width: 350px;
    font-weight: 500;
}

.notification-popup.success {
    background-color: #4caf50;
    color: white;
}

.notification-popup.show {
    transform: translateX(0);
}

.notification-popup.hide {
    transform: translateX(400px);
    opacity: 0;
}
============================================================

============================================================
FILE: transport_providers.json
============================================================
[
    {
        "id": "Anh HoÃ i - Váº­n chuyá»ƒn ná»™i thÃ nh HÃ  Ná»™i",
        "name": "Anh HoÃ i - Váº­n chuyá»ƒn ná»™i thÃ nh HÃ  Ná»™i"
    },
    {
        "id": "CÃ´ng ty Cá»• pháº§n Ä‘áº§u tÆ° thÆ°Æ¡ng máº¡i phÃ¡t triá»ƒn Nháº¥t TÃ­n - CN HÃ  Ná»™i",
        "name": "CÃ´ng ty Cá»• pháº§n Ä‘áº§u tÆ° thÆ°Æ¡ng máº¡i phÃ¡t triá»ƒn Nháº¥t TÃ­n - CN HÃ  Ná»™i"
    },
    {
        "id": "CÃ´ng ty TNHH Dá»‹ch vá»¥ Váº­n Táº£i TÃ¹ng BÃ¡ch",
        "name": "CÃ´ng ty TNHH Dá»‹ch vá»¥ Váº­n Táº£i TÃ¹ng BÃ¡ch"
    }
]
============================================================


ğŸ“Š THá»NG KÃŠ
------------------------------
Tá»•ng sá»‘ file: 23
File code: 14
CÃ¡c loáº¡i file code:
  .css: 1 file
  .js: 1 file
  .json: 1 file
  .md: 1 file
  .py: 7 file
  .txt: 2 file
  .yml: 1 file
